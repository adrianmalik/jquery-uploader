/**
 * jQuery Uploader Library v. 2.0.2
 * https://github.com/adrianmalik/jquery-uploader
 *
 * Copyright 2015 Adrian Malik
 * Released under the MIT license
 */
var Uploader={};Uploader.Input=function(e){var t=this;return this.attachOnChange=function(n){return $(e).on("change",function(t){for(var o=t.originalEvent.srcElement.files,r=0;r<o.length;r++)n.renderItem(o[r]);$(e).val("")}),t},this.hide=function(){return $(e).hide(),t},this.getHtmlElement=function(){return e},t},Uploader.Preview=function(e){var t=this;this.counter,this.htmlElements,this.crop=e.crop,this.error=e.error,this.render=e.render,this.styles=e.styles,this.upload=e.upload,this.maxFiles=e.maxFiles,this.minFileSize=e.minFileSize,this.maxFileSize=e.maxFileSize,this.errorMessages=e.errorMessages,this.allowedMimeTypes=e.allowedMimeTypes,this.allowedExtensions=e.allowedExtensions,this.forbiddenMimeTypes=e.forbiddenMimeTypes,this.forbiddenExtensions=e.forbiddenExtensions,this.renderContainer=function(){return t.htmlElements=t.render(),t},this.renderItem=function(e){var n=t.validateFile(e);n?"function"==typeof t.error&&t.error(n):("number"!=typeof t.counter?t.counter=1:t.counter++,t.handleItem(e))},this.validateFile=function(e){var n=new Uploader.Validator,o=n.validateFileExtension(e,{allowedExtensions:t.allowedExtensions,forbiddenExtensions:t.forbiddenExtensions},t.errorMessages);return o||(o=n.validateFileMimeType(e,{allowedMimeTypes:t.allowedMimeTypes,forbiddenMimeTypes:t.forbiddenMimeTypes},t.errorMessages)),o||(o=n.validateFileSize(e,t.maxFileSize,t.minFileSize,t.errorMessages)),o||(o=n.validateFilesNumber(t.maxFiles,t.counter,t.errorMessages)),o||(o=n.validateCropping(t.getHtmlThumbnailTagForFile(e),t.crop)),o},this.handleItem=function(e){var n=null,o=null,r=null,i=null,a=$(t.htmlElements.item).clone(),l=t.generatePreview(e);$(t.htmlElements.container).append(a);for(var s in t.htmlElements)if("container"!==s&&"item"!==s)switch(s){case"preview":i=$(t.htmlElements[s]).clone(),$(a).append(i.append(l));break;case"upload":n=$(t.htmlElements[s]).clone(),$(a).append(n);break;case"cancel":o=$(t.htmlElements[s]).clone(),$(a).append(o);break;case"progress":r=$(t.htmlElements[s]).clone(),$(a).append(r);break;default:$(a).append($(t.htmlElements[s]).clone())}t.attachUploadEvent(n,o,e,r,a)},this.generatePreview=function(e){var n,o=t.styles,r=new Uploader.Html,i=new Uploader.Thumbnail;switch(t.getHtmlThumbnailTagForFile(e)){case r.TAG_IMG:n=i.getImage(e,o);break;case r.TAG_VIDEO:n=i.getVideo(e,o);break;default:n=i.getDefault(e,o)}return n},this.getHtmlThumbnailTagForFile=function(e){var t=e.type;if("string"!=typeof t)throw new Error("Invalid mime type for preview");var n=(new Uploader.Html).TAG_DIV;return-1!=t.indexOf("image")&&(n=(new Uploader.Html).TAG_IMG),-1!=t.indexOf("video")&&(n=(new Uploader.Html).TAG_VIDEO),n},this.attachUploadEvent=function(e,n,o,r,i){var a;$(e).on("click",function(n){a=new Uploader.Request(e,o,r,t.upload),n.preventDefault()}),$(n).on("click",function(e){"undefined"!=typeof a&&a.abort(),$(i).remove(),t.counter--,e.preventDefault()})}},Uploader.Request=function(e,t,n,o){var r=new XMLHttpRequest;r.open("POST",o.url),r.onloadstart=function(n){o.onLoadStart(n,t,e)},r.onabort=function(n){o.onAbort(n,t,e)},r.onerror=function(n){o.onError(n,t,e)},r.onload=function(n){o.onLoad(n,t,e)},r.onloadend=function(n){200!=r.status?o.onError(n,t,e):o.onSuccess(n,t,e),o.onLoadEnd(n,t,e)},r.ontimeout=function(n){o.onTimeout(n,t,e)},r.onprogress=function(r){if(r.lengthComputable){var i=r.loaded/r.total*100;$(n).attr("value",i)}o.onProgress(r,t,e)};var i=new FormData;return i.append("files",t),r.send(i),r},Uploader.Thumbnail=function(){var e=this,t=function(t,n){if("object"==typeof n)for(var o in n)$(t).css(o,n[o]);return e};this.getImage=function(e,n){var o=(new Uploader.Html).getImg(),r=new FileReader;return r.onloadend=function(){o.src=r.result,t(o,n)},r.readAsDataURL(e),o},this.getVideo=function(e,n){var o=new(Uploader.Html().getVideo),r=new FileReader;return r.onloadend=function(){o.src=r.result,t(o,n)},r.readAsDataURL(e),o},this.getDefault=function(e){return e.name},this.filterParams=function(e){var t=new Uploader.Html;return typeof e!==t.TYPE_OBJECT&&(e={}),typeof e.container!==t.TYPE_OBJECT&&(e.container=t.getUl(),$("#preview").html(e.container)),typeof e.item!==t.TYPE_OBJECT&&(e.item=t.getLi()),typeof e.preview!==t.TYPE_OBJECT&&(e.preview=t.getDiv()),typeof e.progress!==t.TYPE_OBJECT&&(e.progress=t.getProgress()),typeof e.upload!==t.TYPE_OBJECT&&(e.upload=t.getButton(),e.upload.setAttribute("class","upload"),$(e.upload).text("Upload")),typeof e.cancel!==t.TYPE_OBJECT&&(e.cancel=t.getButton(),e.cancel.setAttribute("class","cancel"),$(e.cancel).text("Cancel")),e}},Uploader.Validator=function(){var e=function(e){var t="",n="";for(index in e)isNaN(e[index])?t+=e[index]:n+=e[index];if(n=parseInt(n),t)switch(t.toUpperCase()){case"B":break;case"KB":n=1024*n;break;case"MB":n=1024*n*1024;break;case"GB":n=1024*n*1024*1024;break;case"TB":n=1024*n*1024*1024*1024;break;case"PB":n=1024*n*1024*1024*1024*1024}return n};this.validateFileSize=function(t,n,o,r){var i=null;if("string"==typeof n){var n=e(n);t.size>n&&(i="object"==typeof r&&"string"!=typeof r.tooLargeFile&&r.tooLargeFile?r.tooLargeFile:"Your file is too large.")}if("string"==typeof o){var o=e(o);t.size<o&&(i="object"==typeof r&&"string"!=typeof r.tooSmallFile&&r.tooSmallFile?r.tooSmallFile:"Your file is too small.")}return i},this.validateFileMimeType=function(e,t,n){var o=null,r=t.allowedMimeTypes,i=t.forbiddenMimeTypes;return"object"==typeof r&&r.length>0&&-1===r.indexOf(e.type)&&(o="object"==typeof n&&"string"!=typeof n.forbidden&&n.forbidden?n.forbidden:"File is forbidden."),"object"==typeof i&&i.length>0&&-1!==i.indexOf(e.type)&&(o="object"==typeof n&&"string"!=typeof n.forbidden&&n.forbidden?n.forbidden:"File is forbidden."),o},this.validateFilesNumber=function(e,t,n){var o=null;return"number"==typeof e&&t>=e&&(o="object"==typeof n&&"string"!=typeof n.tooManyFiles&&n.tooManyFiles?n.tooManyFiles:"You cannot upload more files."),o},this.validateFileExtension=function(e,t,n){var o=null,r=t.allowedExtensions,i=t.forbiddenExtensions;if("object"==typeof r&&r.length>0){var a=e.name.split(".").pop();-1===r.indexOf(a)&&(o="object"==typeof n&&"string"!=typeof n.forbidden&&n.forbidden?n.forbidden:"File is forbidden.")}if("object"==typeof i&&i.length>0){var a=e.name.split(".").pop();-1!==i.indexOf(a)&&(o="object"==typeof n&&"string"!=typeof n.forbidden&&n.forbidden?n.forbidden:"File is forbidden.")}return o},this.validateCropping=function(e,t){var n=null,o=new Uploader.Html;return t&&e!==o.TAG_IMG&&(n="You can only crop images."),n}},Uploader.Filter=function(){var e=this;this.filterParams=function(t){return"object"!=typeof t&&(t={}),"object"!=typeof t.browser&&(t.browser={}),"object"!=typeof t.preview&&(t.preview={}),t.browser=e.filterBrowserParams(t.browser),t.preview=e.filterPreviewParams(t.preview),t},this.filterBrowserParams=function(e){return"function"!=typeof e.render&&(e.render=function(){var e=document.createElement("button");return $(e).text("Select file"),e}),"function"!=typeof e.onDrop&&(e.onDrop=function(){}),"function"!=typeof e.onClick&&(e.onClick=function(){}),"function"!=typeof e.onDragOver&&(e.onDragOver=function(){}),"function"!=typeof e.onDragLeave&&(e.onDragLeave=function(){}),"function"!=typeof e.onDragEnter&&(e.onDragEnter=function(){}),e},this.filterPreviewParams=function(e){return"object"!=typeof e.upload&&(e.upload={}),"function"!=typeof e.upload.onLoadStart&&(e.upload.onLoadStart=function(){}),"function"!=typeof e.upload.onProgress&&(e.upload.onProgress=function(){}),"function"!=typeof e.upload.onAbort&&(e.upload.onAbort=function(){}),"function"!=typeof e.upload.onError&&(e.upload.onError=function(){}),"function"!=typeof e.upload.onSuccess&&(e.upload.onSuccess=function(){}),"function"!=typeof e.upload.onLoad&&(e.upload.onLoad=function(){}),"function"!=typeof e.upload.onLoadEnd&&(e.upload.onLoadEnd=function(){}),"function"!=typeof e.upload.onTimeout&&(e.upload.onTimeout=function(){}),"string"!=typeof e.upload.url&&(e.upload.url="/upload"),"boolean"!=typeof e.crop&&(e.crop=!1),"undefined"!=typeof e.maxFiles&&isNaN(e.maxFiles)&&(e.maxFiles=1),e}},Uploader.Browser=function(e){var t=this;this.htmlElement,this.onDrop=e.onDrop,this.onClick=e.onClick,this.onDragOver=e.onDragOver,this.onDragEnter=e.onDragEnter,this.onDragLeave=e.onDragLeave,this.render=function(){return t.htmlElement=e.render(),t},this.attachOnDrop=function(e){return $(t.htmlElement).on("drop",function(n){n.preventDefault();for(var o=0;o<n.originalEvent.dataTransfer.files.length;o++)e.renderItem(n.originalEvent.dataTransfer.files[o]);t.onDrop(this,n)}),t},this.attachOnDragEnter=function(){return $(t.htmlElement).on("dragenter",function(e){e.stopPropagation(),e.preventDefault(),t.onDragEnter(this,e)}),t},this.attachOnDragOver=function(){return $(t.htmlElement).on("dragover",function(e){e.stopPropagation(),e.preventDefault(),t.onDragOver(this,e)}),t},this.attachOnDragLeave=function(){return $(t.htmlElement).on("dragleave",function(e){e.stopPropagation(),e.preventDefault(),t.onDragLeave(this,e)}),t},this.attachOnClick=function(e){return $(t.htmlElement).on("click",function(n){n.preventDefault(),$(e.getHtmlElement()).trigger("click"),t.onClick(this,n)}),t}},Uploader.Html=function(){var e=this;this.TAG_UL="ul",this.TAG_LI="li",this.TAG_IMG="img",this.TAG_DIV="div",this.TAG_SPAN="span",this.TAG_VIDEO="video",this.TAG_BUTTON="button",this.TAG_PROGRESS="progress",this.TYPE_OBJECT="object",this.TYPE_STRING="string",this.TYPE_NUMBER="number",this.TYPE_UNDEFINED="undefined",this.getUl=function(){return document.createElement(e.TAG_UL)},this.getLi=function(){return document.createElement(e.TAG_LI)},this.getImg=function(){return document.createElement(e.TAG_IMG)},this.getDiv=function(){return document.createElement(e.TAG_DIV)},this.getSpan=function(){return document.createElement(e.TAG_SPAN)},this.getVideo=function(){return document.createElement(e.TAG_VIDEO)},this.getButton=function(){return document.createElement(e.TAG_BUTTON)},this.getProgress=function(){var t=document.createElement(e.TAG_PROGRESS);return $(t).attr("value","0").attr("max","100"),t}};